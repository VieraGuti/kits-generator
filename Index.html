<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kits Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Kits Generator</h1>

        <div class="inventory">
            <div class="wear" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)">
                <h3>Wear</h3>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'wear')" ondragover="allowDrop(event)"></div>
            </div>
            <div class="main" ondrop="drop(event, 'main')" ondragover="allowDrop(event)">
                <h3>Main</h3>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'main')" ondragover="allowDrop(event)"></div>
            </div>
            <div class="belt" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)">
                <h3>Belt</h3>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
                <div class="slot" ondrop="drop(event, 'belt')" ondragover="allowDrop(event)"></div>
            </div>
        </div>

        <div class="controls">
            <label for="kitName">Nombre del Kit:</label>
            <input type="text" id="kitName" placeholder="Nombre del kit">
            <select id="kitDropdown"></select>
            <button onclick="saveKit()">Guardar Kit</button>
            <button onclick="copyCommands()">Copiar Comandos</button>
            <button onclick="openEditModal(currentKit)">Editar Kit</button>
            <select id="itemDropdown"></select>
            <button onclick="addItem()">Añadir Ítem</button>
        </div>

        <div id="editModal" style="display:none;">
            <label for="editKitName">Nuevo Nombre del Kit:</label>
            <input type="text" id="editKitName" placeholder="Nuevo nombre">
            <button onclick="confirmEditKit()">Confirmar</button>
            <button onclick="closeEditModal()">Cancelar</button>
        </div>
    </div>

    <script src="Items.js"></script>
    <script>
        let kits = {};
        let currentKit = null;

        window.onload = function () {
            loadItems();
        };

        function loadItems() {
            const itemDropdown = document.getElementById("itemDropdown");
            Items.forEach(item => {
                const option = document.createElement("option");
                option.value = item.id;
                option.text = item.name;
                itemDropdown.add(option);
            });
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event, section) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const slot = event.target;

            if (slot.classList.contains('slot')) {
                if (slot.hasChildNodes()) {
                    if (confirm("Esta ranura ya tiene un ítem. ¿Deseas reemplazarlo?")) {
                        slot.innerHTML = ""; // Limpiar slot
                    } else {
                        return;
                    }
                }
                const img = document.createElement("img");
                img.src = data;
                img.draggable = true;
                img.ondragstart = (e) => {
                    e.dataTransfer.setData("text", data);
                };
                slot.appendChild(img);
            }
        }

        function saveKit() {
            const kitName = document.getElementById("kitName").value || document.getElementById("kitDropdown").value;
            const commands = generateCommands(kitName);
            if (!kits[kitName]) {
                kits[kitName] = commands.split("\n");
                alert("Kit guardado: " + kitName);
                updateKitDropdown();
            } else {
                alert("Ya existe un kit con ese nombre.");
            }
        }

        function updateKitDropdown() {
            const kitDropdown = document.getElementById("kitDropdown");
            kitDropdown.innerHTML = ""; // Limpiar dropdown
            for (const kitName in kits) {
                const option = document.createElement("option");
                option.value = kitName;
                option.text = kitName;
                kitDropdown.add(option);
            }
        }

        function generateCommands(kitName) {
            let commands = [];
            const slots = document.querySelectorAll('.slot');

            slots.forEach((slot) => {
                if (slot.hasChildNodes()) {
                    const img = slot.querySelector("img");
                    const id = img.src.split('/').pop().split('.')[0]; // Obtener ID de la imagen
                    const quantity = img.dataset.quantity || 1;
                    const location = determineLocation(slot);
                    commands.push(`Kit add "${kitName}" "${id}" "${quantity}" "1" "${location}"`);
                }
            });

            return commands.join("\n");
        }

        function determineLocation(slot) {
            if (slot.parentNode.classList.contains('wear')) return 'Wear';
            if (slot.parentNode.classList.contains('main')) return 'Main';
            if (slot.parentNode.classList.contains('belt')) return 'Belt';
            return '';
        }

        function copyCommands() {
            const kitName = document.getElementById("kitName").value || document.getElementById("kitDropdown").value;
            if (kits[kitName]) {
                const commands = kits[kitName].join("\n");
                navigator.clipboard.writeText(commands).then(() => {
                    alert("Comandos copiados al portapapeles.");
                });
            } else {
                alert("No existe un kit con ese nombre.");
            }
        }

        function openEditModal(kitName) {
            if (!kits[kitName]) return;
            currentKit = kitName;
            document.getElementById("editKitName").value = kitName;
            document.getElementById("editModal").style.display = "block";
        }

        function confirmEditKit() {
            const newName = document.getElementById("editKitName").value;
            if (kits[currentKit]) {
                kits[newName] = kits[currentKit];
                delete kits[currentKit];
                alert("Kit editado: " + newName);
                updateKitDropdown();
            }
            closeEditModal();
        }

        function closeEditModal() {
            document.getElementById("editModal").style.display = "none";
        }

        function addItem() {
            const itemDropdown = document.getElementById("itemDropdown");
            const selectedItemId = itemDropdown.value;
            const selectedItem = Items.find(item => item.id === selectedItemId);
            const img = document.createElement("img");
            img.src = selectedItem.image; // Suponiendo que 'image' es el nombre de la propiedad en Items.js
            img.draggable = true;
            img.ondragstart = (e) => {
                e.dataTransfer.setData("text", img.src);
            };
            const slot = document.querySelector('.slot');
            slot.appendChild(img);
        }
    </script>
</body>
</html>
